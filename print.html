<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ditto-book</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="FAQ.html"><strong aria-hidden="true">1.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="protocol-documentation.html"><strong aria-hidden="true">2.</strong> Protocol Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="token-ejector.html"><strong aria-hidden="true">2.1.</strong> Token Ejector</a></li><li class="chapter-item expanded "><a href="multidimensional-clones.html"><strong aria-hidden="true">2.2.</strong> Multidimensional Clones</a></li><li class="chapter-item expanded "><a href="vouchers.html"><strong aria-hidden="true">2.3.</strong> Vouchers</a></li></ol></li><li class="chapter-item expanded "><a href="user-guide.html"><strong aria-hidden="true">3.</strong> User Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="bid.html"><strong aria-hidden="true">3.1.</strong> Open a Position on an NFT</a></li><li class="chapter-item expanded "><a href="sell.html"><strong aria-hidden="true">3.2.</strong> Selling an NFT</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">ditto-book</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/ditto-lab" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Ditto Protocol is a trustless and governance-free NFT Futures protocol.</p>
<h2 id="protocol-overview"><a class="header" href="#protocol-overview">Protocol Overview</a></h2>
<p>Interested buyers of an NFT can mint or buy a Future, called a Clone.</p>
<p>Each clone encodes –</p>
<ul>
<li>an NFT collection,</li>
<li>a specific token or the floor of that NFT collection,</li>
<li>its current worth,</li>
<li>minimum bid amount to purchase the clone decided by the smart contract.</li>
</ul>
<p>If a bidder bids on a clone with an amount greater than the minimum bid amount, the clone is transferred to them from the current owner. On each Clone transfer, a fee is taken from the bid amount which is split between the previous holder of the Clone and a separate pool.</p>
<p>A clone represents a claim to receive the NFT when it’s sold via Ditto Protocol. A clone can be a floor Future, which means its worth is the minimum amount the NFT seller gets.</p>
<p>As that Clone gets traded, the pool size increases, incentivizing the NFT holder to sell their NFT via the Ditto Protocol.</p>
<p>Protocol features –</p>
<ul>
<li>Ditto protocol is fully trustless and governance free. All the parameters are hardcoded in the contract with no way to change it after deployment.</li>
<li>There is no protocol fee, and any other fee is to incentivize protocol participation.</li>
<li>We are looking at Verifiable Delay Functions (VDF) to combat front running.</li>
<li>TWAP oracle for clone prices.</li>
<li>On a clone transfer from a bidder, in addition to receiving a part of the fee from the higher bid, they’ll receive an on-chain NFT. We believe this will act as an additional incentive to participate in the protocol, and we want to work with an artist to make these NFTs something people will want to own.</li>
</ul>
<p>The protocol is inspired by the <a href="https://www.radicalxchange.org/kiosk/blog/millennials-zoomers-and-salsa-just-radical-enough/">SALSA</a> concept from <a href="https://twitter.com/RadxChange">radicalxchange</a>.</p>
<h2 id="gitcoin-grant"><a class="header" href="#gitcoin-grant">Gitcoin Grant</a></h2>
<p>If you want to support us, we are accepting funding via our <a href="https://gitcoin.co/grants/4866/ditto-protocol-trustless-nft-futures">Gitcoin grant</a>.</p>
<h2 id="reference"><a class="header" href="#reference">Reference</a></h2>
<ul>
<li><a href="https://github.com/ditto-lab/">Github</a></li>
<li><a href="https://twitter.com/ditto_lab">Twitter</a></li>
<li><a href="https://ditto-lab.github.io/">Website</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="faqs"><a class="header" href="#faqs">FAQs</a></h1>
<h2 id="general"><a class="header" href="#general">General</a></h2>
<h3 id="what-is-ditto"><a class="header" href="#what-is-ditto">What is Ditto?</a></h3>
<p>Ditto a is a decentralized and permissionless protocol used to create tradable non-fungible <a href="https://en.wikipedia.org/wiki/Perpetual_futures">futures</a> of non-fungible tokens. Anyone may create a future, called a clone, for any NFT or purchase one that has already been created at any time.</p>
<h3 id="how-does-ditto-work"><a class="header" href="#how-does-ditto-work">How does Ditto work?</a></h3>
<p>Ditto operates using a hybrid auction mechanism, innspired by <a href="https://www.radicalxchange.org/kiosk/blog/millennials-zoomers-and-salsa-just-radical-enough/">SALSA</a> and dutch auctions.</p>
<p>A clone of an underlying NFT may be created by anyone at anytime at a self-assessed price. Once the clone is created it is put up for auction similar to SALSA, however the Ditto smart contract calculates the minimum price one must pay to take ownership of the clone, starting at double the clone's assessed price and decreasing towards the assessed price over a set period of time. This auction resets whenever a clone is traded via this mechanism.</p>
<p>While a clone exists for an underlying NFT this effectively gives its owner an option to sell the NFT through Ditto. When the underlying NFT is sold through Ditto its clone is burned, the seller receives the funds represented by the clone, and the clone owner receives the underlying NFT.</p>
<h3 id="what-is-a-clone"><a class="header" href="#what-is-a-clone">What is a clone?</a></h3>
<p>A clone is an ERC-721 non-fungible token representing the right receive a particular NFT when it is sold via the Ditto protocol. The clone may be traded freely and interface with any applications accepting ERC-721 tokens.</p>
<h3 id="what-fees-are-associated-with-ditto"><a class="header" href="#what-fees-are-associated-with-ditto">What fees are associated with Ditto?</a></h3>
<p>When a clone is created a fee is set aside from the position's value, as well as any time the clone is subsequently traded via Ditto's auction mechanism. The fee can range between %0.04882887 and %12.451361868 depending on how frequently it is traded via Ditto's auctions.</p>
<h3 id="why-sell-an-nft-through-ditto"><a class="header" href="#why-sell-an-nft-through-ditto">Why sell an NFT through Ditto?</a></h3>
<p>Whenever a clone is traded via Ditto's auction mechanism a fee is taken and pooled towards the underlying NFT. When the underlying NFT is sold via Ditto the pooled fees are transferred to the NFT seller along with the value of the clone.</p>
<h3 id="what-is-salsa"><a class="header" href="#what-is-salsa">What is SALSA</a></h3>
<p>Salsa is an auction mechanism from <a href="https://twitter.com/RadxChange">radicalxchange</a>. You can read more about it {here}(https://en.wikipedia.org/wiki/Perpetual_futures).</p>
<h3 id="what-is-a-dutch-auction"><a class="header" href="#what-is-a-dutch-auction">What is a dutch auction?</a></h3>
<p>An <a href="https://en.wikipedia.org/wiki/Dutch_auction">auction</a> where the selling price starts high and descends until a participant accepts the price.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="protocol-documentation"><a class="header" href="#protocol-documentation">Protocol Documentation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="token-ejector"><a class="header" href="#token-ejector">Token Ejector</a></h1>
<p>If you are developing a smart contract that plans to hold Ditto clones it is worth considering implementing the token ejector.</p>
<pre><code class="language-solidity">interface IERC721TokenEjector {

    function onERC721Ejected(
        address operator,
        address to,
        uint256 id,
        bytes calldata data
    ) external returns (bytes4);

}
</code></pre>
<p>Because a clone can be force transferred from one owner to a new owner via the Ditto auction mechanism the Ditto contract will try to call the <code>onERC721Ejected</code> function on the previous owner.</p>
<pre><code class="language-solidity">if (from.code.length != 0) {
    try IERC721TokenEjector(from).onERC721Ejected{gas: 30000}(address(this), to, id, &quot;&quot;) {} // EXTERNAL CALL
    catch {}
}
</code></pre>
<p>This will allow any smart contract that implements the token ejector a chance to do their own accounting or enact any necessary actions when the clone is force transferred from them to the new owner.</p>
<p>The function call is given up to a <code>30 000</code> gas stipend to accomplish its goals. This should be more than enough gas to get anything reasonable done.</p>
<p>If your contract does not implement <code>onERC721Ejected</code> the forced transfer will proceed as intended in any case.</p>
<p>It is highly recommended when implementing <code>onERC721Ejected</code> to check that <code>msg.sender</code> and/or <code>operator</code> are coming from the expected address. Not properly checking these could result in a potential exploit or unintended behaviour.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multidimensional-clones"><a class="header" href="#multidimensional-clones">Multidimensional Clones</a></h1>
<p>Ditto Protocol creates a queue of clones. Each clone is that queue represent an eventual claim on some unique NFT. The clone at the front of the queue has the immediate claim on the underlying NFT when sold through the protocol.</p>
<p>As soon as this trade happens, the NFT is transferred to that clone owner, and the clone is burned.</p>
<p>Here's a more technical description for accuracy -</p>
<p>A queue <code>Q</code> is identified by a parameter <code>protoId</code> which is a hash of</p>
<ul>
<li>the underlying <code>ERC721</code>/<code>ERC1155</code> contract adress, say <code>A</code>.</li>
<li><code>tokenId</code> of <code>A</code>, say <code>id</code></li>
<li>the <code>ERC20</code> contract, say <code>B</code></li>
<li>and a boolean <code>floor</code>.</li>
</ul>
<p>All put together this means that the clones part of this queue want a claim on the NFT represented by <code>A</code> with tokenId <code>id</code>, and they are bidding using tokens of <code>B</code>. If <code>floor</code> is <code>true</code>, the clones are not bidding for any specific token in the NFT collection. In this case, <code>id</code> must have a constant value - <code>FLOOR_ID</code>.</p>
<p>The queue now contains indexes (non-negative integers), and a <code>(protoId, index)</code> tuple uniquely identifies a clone. In fact, <code>cloneId</code> is defined as the hash of <code>protoId</code> and <code>index</code>.</p>
<p>A bidder is allowed to bid on an existing clone, or a new clone which is pushed at the end of the queue. If no clone is dissolved, the index of the clones in the queue will be <code>0,1,2,...</code> and so on. But since, a clone can be dissolved, at any moment the queue will be missing the indexes corresponding to the dissolved clones.</p>
<h2 id="duplicate"><a class="header" href="#duplicate">Duplicate</a></h2>
<h2 id="dissolve"><a class="header" href="#dissolve">Dissolve</a></h2>
<p>A clone owner can choose to burn the clone, which in effect, removes their claim on the underlying NFT.</p>
<ul>
<li>Their bid is returned after subtracting the subsidy and fee.</li>
<li>The subsidy is passed to the clone next in the queue.</li>
<li>The corresponding index is removed from the queue.</li>
</ul>
<h2 id="trade"><a class="header" href="#trade">Trade</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vouchers"><a class="header" href="#vouchers">Vouchers</a></h1>
<p>The Ditto smart contract keeps track of <code>vouchers</code>, a kind of receipt for having owned a clone with a position on an underlying NFT.</p>
<p><code>vouchers</code> are recorded any time a larger position on a clone's underlying NFT replaces the current position.</p>
<p>The important information about the position is hashed into a unique 32 byte identifier and stored in the contract. Anyone may read the smart contract to see if a voucher's identifier has been recorded. This allows for any party to construct a reward system or incentivize trading on top of Ditto.</p>
<h2 id="encoded-information"><a class="header" href="#encoded-information">Encoded Information</a></h2>
<ul>
<li><code>cloneId</code> The clone ID itself contains a lot of useful information.
<ul>
<li>The clone's <code>protoId</code> containing the NFT contract address, token ID, ERC20 address, and a <code>floor</code> boolean.</li>
<li>The clone's Index.</li>
</ul>
</li>
<li>The recipient of the <code>voucher</code>.</li>
<li><code>heat</code> property at the time.</li>
<li>The smaller position's value.</li>
<li>The larger position's value.</li>
<li>The time at which the smaller position was opened.</li>
<li>The time at which the voucher was issued.</li>
<li>If the clone was at the head of the auction que at time of voucher issue.</li>
</ul>
<p>These variables should be helpful for any party interested in constructing incentives on top of Ditto.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-guide"><a class="header" href="#user-guide">User Guide</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bidding-on-nft"><a class="header" href="#bidding-on-nft">Bidding on NFT</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="selling-an-nft"><a class="header" href="#selling-an-nft">Selling an NFT</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
                
    </body>
</html>
